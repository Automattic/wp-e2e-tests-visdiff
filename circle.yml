machine:
  environment:
    NODE_ENV: test
  node:
    version: 6.9.0
  hosts:
    lorempixel.com: 127.0.0.1
    placekitten.com: 127.0.0.1

checkout:
  post:
    - git submodule init
    - git submodule update --remote --force

dependencies:
  cache_directories:
    - "wp-e2e-tests/node_modules"
  override:
    - cd wp-e2e-tests && npm pack lib/reporter
    - cd wp-e2e-tests && npm install ./spec-xunit-slack-reporter-0.0.1.tgz
    - cd wp-e2e-tests && npm install

test:
  override:
    - >
      export TESTARGS="-m ${BROWSERS-all}"

      if [ "$RUN_SPECIFIED" == "true" ]; then
        TESTARGS=$RUN_ARGS
      fi

      cd wp-e2e-tests && git checkout origin/${E2E_BRANCH-master} && ./run.sh $TESTARGS
